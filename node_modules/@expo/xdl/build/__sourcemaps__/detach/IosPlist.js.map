{"version":3,"sources":["detach/IosPlist.ts"],"names":["_getNormalizedPlistFilename","plistName","plistFilename","indexOf","modifyAsync","plistPath","transform","configPlistName","path","join","configFilename","config","process","platform","configContents","fs","readFile","JSON","parse","e","logger","info","plist","readFileSync","writeFile","stringify","build","createBlankAsync","emptyConfig","tmpConfigFile","cleanBackupAsync","restoreOriginal","backupPlistPath","pathExists","copy","remove"],"mappings":"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","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport plist from '@expo/plist';\n\nimport { spawnAsyncThrowError } from './ExponentTools';\nimport logger from './Logger';\n\nfunction _getNormalizedPlistFilename(plistName: string) {\n  let plistFilename;\n  if (plistName.indexOf('.') !== -1) {\n    plistFilename = plistName;\n  } else {\n    plistFilename = `${plistName}.plist`;\n  }\n  return plistFilename;\n}\n\n/**\n *  @param plistName base filename of property list. if no extension, assumes .plist\n */\nasync function modifyAsync(plistPath: string, plistName: string, transform: (config: any) => any) {\n  let plistFilename = _getNormalizedPlistFilename(plistName);\n  let configPlistName = path.join(plistPath, plistFilename);\n  let configFilename = path.join(plistPath, `${plistName}.json`);\n\n  // grab original plist as json object\n  let config;\n  if (process.platform === 'darwin') {\n    await spawnAsyncThrowError('plutil', [\n      '-convert',\n      'json',\n      configPlistName,\n      '-o',\n      configFilename,\n    ]);\n    let configContents = await fs.readFile(configFilename, 'utf8');\n\n    try {\n      config = JSON.parse(configContents);\n    } catch (e) {\n      logger.info(`Error parsing ${configFilename}`, e);\n      logger.info('The erroneous file contents was:', configContents);\n      config = {};\n    }\n  } else {\n    config = plist.parse(fs.readFileSync(configPlistName, 'utf8'));\n  }\n\n  // apply transformation\n  config = transform(config);\n\n  // back up old plist and swap in modified one\n  await spawnAsyncThrowError('/bin/cp', [configPlistName, `${configPlistName}.bak`]);\n  await fs.writeFile(configFilename, JSON.stringify(config));\n  if (process.platform === 'darwin') {\n    await spawnAsyncThrowError('plutil', [\n      '-convert',\n      'xml1',\n      configFilename,\n      '-o',\n      configPlistName,\n    ]);\n  } else {\n    await fs.writeFile(configPlistName, plist.build(config));\n  }\n\n  return config;\n}\n\nasync function createBlankAsync(plistPath: string, plistName: string) {\n  // write empty json file\n  const emptyConfig = {};\n  const tmpConfigFile = path.join(plistPath, `${plistName}.json`);\n  await fs.writeFile(tmpConfigFile, JSON.stringify(emptyConfig));\n\n  // convert to plist\n  let plistFilename = _getNormalizedPlistFilename(plistName);\n  let configPlistName = path.join(plistPath, plistFilename);\n  if (process.platform === 'darwin') {\n    await spawnAsyncThrowError('plutil', [\n      '-convert',\n      'xml1',\n      tmpConfigFile,\n      '-o',\n      configPlistName,\n    ]);\n  } else {\n    await fs.writeFile(configPlistName, JSON.stringify(plist.build(emptyConfig)));\n  }\n\n  // remove tmp json file\n  await spawnAsyncThrowError('/bin/rm', [tmpConfigFile]);\n}\n\nasync function cleanBackupAsync(plistPath: string, plistName: string, restoreOriginal = true) {\n  let plistFilename = _getNormalizedPlistFilename(plistName);\n  let configPlistName = path.join(plistPath, plistFilename);\n  let configFilename = path.join(plistPath, `${plistName}.json`);\n  const backupPlistPath = `${configPlistName}.bak`;\n\n  if (restoreOriginal && (await fs.pathExists(backupPlistPath))) {\n    await fs.copy(backupPlistPath, configPlistName);\n  }\n\n  await fs.remove(backupPlistPath);\n  await fs.remove(configFilename);\n}\n\nexport { modifyAsync, cleanBackupAsync, createBlankAsync };\n"],"file":"../../detach/IosPlist.js","sourceRoot":"/@expo/xdl@57.9.17/src"}