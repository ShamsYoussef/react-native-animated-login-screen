{"version":3,"sources":["tools/ModuleVersion.ts"],"names":["createModuleVersionChecker","name","currentVersion","UpdateCacher","Cacher","pkgJson","version","latestVersion","deprecated","checkAsync","getAsync","updateIsAvailable","semver","gt","latest","current"],"mappings":";;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;AAEA,SAASA,0BAAT,CAAoCC,IAApC,EAAkDC,cAAlD,EAA0E;AACxE,QAAMC,YAAY,GAAG,KAAIC,iBAAJ,EACnB,YAAY;AACV,UAAMC,OAAO,GAAG,MAAM,yBAAS,4BAAeJ,IAAf,EAAqB;AAAEK,MAAAA,OAAO,EAAEJ;AAAX,KAArB,CAAT,EAA4D,IAA5D,CAAtB;AACA,WAAO;AACLK,MAAAA,aAAa,EAAE,MAAM,yBAAS,8BAAmBN,IAAnB,CAAT,EAAmC,IAAnC,CADhB;AAELO,MAAAA,UAAU,EAAEH,OAAO,CAACG;AAFf,KAAP;AAID,GAPkB,EAQlB,GAAEP,IAAK,eARW,EASnB,KAAK,EAAL,GAAU,EAAV,GAAe,IATI,CASC;AATD,GAArB;;AAYA,iBAAeQ,UAAf,GAA4B;AAC1B,UAAM;AAAEF,MAAAA,aAAF;AAAiBC,MAAAA;AAAjB,QAAgC,MAAML,YAAY,CAACO,QAAb,EAA5C;AACA,WAAO;AACLC,MAAAA,iBAAiB,EAAEC,kBAAOC,EAAP,CAAUN,aAAV,EAAyBL,cAAzB,CADd;AAELY,MAAAA,MAAM,EAAEP,aAFH;AAGLQ,MAAAA,OAAO,EAAEb,cAHJ;AAILM,MAAAA;AAJK,KAAP;AAMD;;AAED,SAAO;AAAEC,IAAAA;AAAF,GAAP;AACD","sourcesContent":["import latestVersionAsync from 'latest-version';\nimport npmPackageJson from 'package-json';\nimport pTimeout from 'p-timeout';\nimport semver from 'semver';\n\nimport { Cacher } from './FsCache';\n\nfunction createModuleVersionChecker(name: string, currentVersion: string) {\n  const UpdateCacher = new Cacher(\n    async () => {\n      const pkgJson = await pTimeout(npmPackageJson(name, { version: currentVersion }), 2000);\n      return {\n        latestVersion: await pTimeout(latestVersionAsync(name), 2000),\n        deprecated: pkgJson.deprecated,\n      };\n    },\n    `${name}-updates.json`,\n    24 * 60 * 60 * 1000 // one day\n  );\n\n  async function checkAsync() {\n    const { latestVersion, deprecated } = await UpdateCacher.getAsync();\n    return {\n      updateIsAvailable: semver.gt(latestVersion, currentVersion),\n      latest: latestVersion,\n      current: currentVersion,\n      deprecated,\n    };\n  }\n\n  return { checkAsync };\n}\n\nexport { createModuleVersionChecker };\n"],"file":"../../tools/ModuleVersion.js","sourceRoot":"/@expo/xdl@57.9.17/src"}