{"version":3,"file":"dev-server.js","sourceRoot":"","sources":["../../server/dev-server.ts"],"names":[],"mappings":";;;;;AAAA,iEAAwD;AACxD,mCAAoC;AACpC,sDAA8B;AAC9B,gDAAwB;AACxB,gDAAwB;AACxB,8EAAsD;AAEtD,qDAAwF;AAExF,MAAM,IAAI,GAAG,IAAI,CAAC;AAElB,KAAK,UAAU,GAAG;IAChB,IAAI;QACF,MAAM,UAAU,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACnC,IAAI,CAAC,UAAU,EAAE;YACf,MAAM,IAAI,KAAK,CAAC,0DAA0D,CAAC,CAAC;SAC7E;QAED,MAAM,GAAG,GAAQ,cAAI,CAAC,EAAE,GAAG,EAAE,IAAI,EAAE,CAAC,CAAC;QACrC,MAAM,GAAG,CAAC,OAAO,EAAE,CAAC;QAEpB,MAAM,MAAM,GAAG,iBAAO,EAAE,CAAC;QACzB,MAAM,qBAAqB,GAAG,MAAM,iDAAgC,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;QACrF,MAAM,CAAC,GAAG,CAAC,iBAAiB,EAAE,qBAAqB,CAAC,cAAc,CAAC,CAAC;QACpE,MAAM,CAAC,GAAG,CACR,WAAW,EACX,uCAAe,CAAC;YACd,WAAW,EAAE,qBAAqB,CAAC,mBAAmB;YACtD,yBAAyB,EAAE;gBACzB,yBAAyB,EAAE,qBAAqB,CAAC,yBAAyB;aAC3E;SACF,CAAC,CACH,CAAC;QACF,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,iBAAiB,EAAE,CAAC,CAAC;QAEzC,MAAM,UAAU,GAAG,cAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;QAC7C,MAAM,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;YACpC,UAAU,CAAC,IAAI,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;YACjC,UAAU,CAAC,IAAI,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;YACtC,UAAU,CAAC,MAAM,CAAC,IAAI,EAAE,WAAW,CAAC,CAAC;QACvC,CAAC,CAAC,CAAC;QACH,mCAAkB,CAAC,UAAU,EAAE,UAAU,EAAE,qBAAqB,CAAC,CAAC;QAClE,OAAO,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC;QACnC,MAAM,aAAO,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;QACrC,IAAI,GAAG,GAAG,oBAAoB,IAAI,EAAE,CAAC;QACrC,OAAO,CAAC,GAAG,CAAC,iCAAiC,GAAG,EAAE,CAAC,CAAC;QACpD,qBAAW,CAAC,GAAG,CAAC,CAAC;KAClB;IAAC,OAAO,KAAK,EAAE;QACd,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QACrB,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;KACjB;AACH,CAAC;AAED,GAAG,EAAE,CAAC","sourcesContent":["import { graphiqlExpress } from 'apollo-server-express';\nimport { Project } from '@expo/xdl';\nimport express from 'express';\nimport http from 'http';\nimport next from 'next';\nimport openBrowser from 'react-dev-utils/openBrowser';\n\nimport { createAuthenticationContextAsync, startGraphQLServer } from './DevToolsServer';\n\nconst PORT = 3333;\n\nasync function run(): Promise<void> {\n  try {\n    const projectDir = process.argv[2];\n    if (!projectDir) {\n      throw new Error('No project dir specified.\\nUsage: yarn dev <project-dir>');\n    }\n\n    const app: any = next({ dev: true });\n    await app.prepare();\n\n    const server = express();\n    const authenticationContext = await createAuthenticationContextAsync({ port: PORT });\n    server.get('/dev-tools-info', authenticationContext.requestHandler);\n    server.get(\n      '/graphiql',\n      graphiqlExpress({\n        endpointURL: authenticationContext.webSocketGraphQLUrl,\n        websocketConnectionParams: {\n          clientAuthenticationToken: authenticationContext.clientAuthenticationToken,\n        },\n      })\n    );\n    server.get('*', app.getRequestHandler());\n\n    const httpServer = http.createServer(server);\n    await new Promise((resolve, reject) => {\n      httpServer.once('error', reject);\n      httpServer.once('listening', resolve);\n      httpServer.listen(PORT, 'localhost');\n    });\n    startGraphQLServer(projectDir, httpServer, authenticationContext);\n    console.log('Starting project...');\n    await Project.startAsync(projectDir);\n    let url = `http://localhost:${PORT}`;\n    console.log(`Development server running at ${url}`);\n    openBrowser(url);\n  } catch (error) {\n    console.error(error);\n    process.exit(1);\n  }\n}\n\nrun();\n"]}