{"version":3,"file":"mergeAsyncIterators.js","sourceRoot":"","sources":["../../../server/asynciterators/mergeAsyncIterators.ts"],"names":[],"mappings":";;AAAA,qCAA0C;AAE1C,SAAwB,mBAAmB,CAAC,GAAG,SAAqB;IAClE,MAAM,QAAQ,GAAG,SAAS,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,CAAC;IAE3C,OAAO;QACL,KAAK,CAAC,IAAI;YACR,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBACxC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE;oBAChB,QAAQ,CAAC,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;iBACnC;aACF;YACD,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,GAAG,MAAM,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,EAAE,KAAK,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC;YAE3F,aAAa;YACb,QAAQ,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;YACnB,OAAO;gBACL,IAAI,EAAE,KAAK;gBACX,aAAa;gBACb,KAAK,EAAE,MAAM,CAAC,KAAK;aACpB,CAAC;QACJ,CAAC;QAED,KAAK,CAAC,MAAM;YACV,KAAK,MAAM,QAAQ,IAAI,SAAS,EAAE;gBAChC,IAAI,QAAQ,CAAC,MAAM,EAAE;oBACnB,MAAM,QAAQ,CAAC,MAAM,EAAE,CAAC;iBACzB;aACF;YACD,OAAO;gBACL,IAAI,EAAE,IAAI;gBACV,KAAK,EAAE,SAAS;aACjB,CAAC;QACJ,CAAC;QAED,KAAK,CAAC,KAAK,CAAC,KAAK;YACf,KAAK,MAAM,QAAQ,IAAI,SAAS,EAAE;gBAChC,IAAI,QAAQ,CAAC,KAAK,EAAE;oBAClB,MAAM,QAAQ,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;iBAC7B;aACF;YACD,OAAO;gBACL,IAAI,EAAE,IAAI;gBACV,KAAK,EAAE,SAAS;aACjB,CAAC;QACJ,CAAC;QAED,CAAC,yBAAe,CAAC;YACf,OAAO,IAAI,CAAC;QACd,CAAC;KACF,CAAC;AACJ,CAAC;AAjDD,sCAiDC","sourcesContent":["import { $$asyncIterator } from 'iterall';\n\nexport default function mergeAsyncIterators(...iterators: Array<any>) {\n  const promises = iterators.map(() => null);\n\n  return {\n    async next() {\n      for (let i = 0; i < promises.length; i++) {\n        if (!promises[i]) {\n          promises[i] = iterators[i].next();\n        }\n      }\n      const [i, result] = await Promise.race(promises.map(async (value, i) => [i, await value]));\n\n      // @ts-ignore\n      promises[i] = null;\n      return {\n        done: false,\n        // @ts-ignore\n        value: result.value,\n      };\n    },\n\n    async return() {\n      for (const iterator of iterators) {\n        if (iterator.return) {\n          await iterator.return();\n        }\n      }\n      return {\n        done: true,\n        value: undefined,\n      };\n    },\n\n    async throw(error) {\n      for (const iterator of iterators) {\n        if (iterator.throw) {\n          await iterator.throw(error);\n        }\n      }\n      return {\n        done: true,\n        value: undefined,\n      };\n    },\n\n    [$$asyncIterator]() {\n      return this;\n    },\n  };\n}\n"]}