{"version":3,"sources":["../../src/credentials/route.ts"],"names":["runCredentialsManagerStandalone","ctx","startView","manager","CredentialsManager","AskQuit","run","runCredentialsManager","DoQuit","constructor","quit","_manager","_ctx","_mainView","_currentView","_quit","get","Error","open","runAsync","error","QuitError","Promise","res","setTimeout","changeMainView","view"],"mappings":";;;;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAGA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;;;AAEO,eAAeA,+BAAf,CAA+CC,GAA/C,EAA6DC,SAA7D,EAA+E;AACpF,QAAMC,OAAO,GAAG,IAAIC,kBAAJ,CAAuBH,GAAvB,EAA4BC,SAA5B,EAAuC,KAAIG,iBAAJ,GAAvC,CAAhB;AACA,QAAMF,OAAO,CAACG,GAAR,EAAN;AACD;;AAEM,eAAeC,qBAAf,CAAqCN,GAArC,EAAmDC,SAAnD,EAAoF;AACzF,QAAMC,OAAO,GAAG,IAAIC,kBAAJ,CAAuBH,GAAvB,EAA4BC,SAA5B,EAAuC,KAAIM,gBAAJ,GAAvC,CAAhB;AACA,SAAO,MAAML,OAAO,CAACG,GAAR,EAAb;AACD;;AAEM,MAAMF,kBAAN,CAAyB;AAO9BK,EAAAA,WAAW,CAACR,GAAD,EAAeC,SAAf,EAAiCQ,IAAjC,EAA8C;AAAA;;AAAA;;AAAA;;AAAA;;AACvDN,IAAAA,kBAAkB,CAACO,QAAnB,GAA8B,IAA9B;AACA,SAAKC,IAAL,GAAYX,GAAZ;AACA,SAAKY,SAAL,GAAiBX,SAAjB;AACA,SAAKY,YAAL,GAAoBZ,SAApB;AACA,SAAKa,KAAL,GAAaL,IAAb;AACD;;AAED,SAAOM,GAAP,GAAiC;AAC/B,QAAI,CAACZ,kBAAkB,CAACO,QAAxB,EAAkC;AAChC,YAAM,IAAIM,KAAJ,CAAU,iDAAV,CAAN;AACD;;AACD,WAAOb,kBAAkB,CAACO,QAA1B;AACD;;AAED,QAAML,GAAN,GAA2B;AACzB,WAAO,IAAP,EAAa;AACX,UAAI;AACF,aAAKQ,YAAL,GACE,CAAC,MAAM,KAAKA,YAAL,CAAkBI,IAAlB,CAAuB,KAAKN,IAA5B,CAAP,MAA8C,MAAM,KAAKG,KAAL,CAAWI,QAAX,CAAoB,KAAKN,SAAzB,CAApD,CADF;AAED,OAHD,CAGE,OAAOO,KAAP,EAAc;AACd;AACA,YAAIA,KAAK,YAAYC,mBAArB,EAAgC;AAC9B,iBAAO,IAAP;AACD,SAJa,CAMd;;;AACA,YAAI,KAAKN,KAAL,YAAsBP,gBAA1B,EAAkC;AAChC;AACA,gBAAMY,KAAN;AACD,SAHD,MAGO;AACL;AACA,8BAAIA,KAAJ;AACA,gBAAM,IAAIE,OAAJ,CAAYC,GAAG,IAAIC,UAAU,CAACD,GAAD,EAAM,IAAN,CAA7B,CAAN;AACA,eAAKT,YAAL,GAAoB,MAAM,KAAKC,KAAL,CAAWI,QAAX,CAAoB,KAAKN,SAAzB,CAA1B;AACD;AACF;AACF;AACF;;AAEDY,EAAAA,cAAc,CAACC,IAAD,EAAc;AAC1B,SAAKb,SAAL,GAAiBa,IAAjB;AACD;;AAjD6B;;;;gBAAnBtB,kB","sourcesContent":["import log from '../log';\n\nimport { Context, IView } from './context';\nimport { AskQuit, DoQuit, IQuit, QuitError } from './views/Select';\n\nexport async function runCredentialsManagerStandalone(ctx: Context, startView: IView) {\n  const manager = new CredentialsManager(ctx, startView, new AskQuit());\n  await manager.run();\n}\n\nexport async function runCredentialsManager(ctx: Context, startView: IView): Promise<null> {\n  const manager = new CredentialsManager(ctx, startView, new DoQuit());\n  return await manager.run();\n}\n\nexport class CredentialsManager {\n  static _manager?: CredentialsManager;\n  _ctx: Context;\n  _mainView: IView;\n  _currentView: IView;\n  _quit: IQuit;\n\n  constructor(ctx: Context, startView: IView, quit: IQuit) {\n    CredentialsManager._manager = this;\n    this._ctx = ctx;\n    this._mainView = startView;\n    this._currentView = startView;\n    this._quit = quit;\n  }\n\n  static get(): CredentialsManager {\n    if (!CredentialsManager._manager) {\n      throw new Error('Credential Manager has not been initialized yet');\n    }\n    return CredentialsManager._manager;\n  }\n\n  async run(): Promise<null> {\n    while (true) {\n      try {\n        this._currentView =\n          (await this._currentView.open(this._ctx)) || (await this._quit.runAsync(this._mainView));\n      } catch (error) {\n        // View quit normally, exit normally\n        if (error instanceof QuitError) {\n          return null;\n        }\n\n        // View encountered error\n        if (this._quit instanceof DoQuit) {\n          // propagate error up\n          throw error;\n        } else {\n          // fallback to interactive Quit View\n          log(error);\n          await new Promise(res => setTimeout(res, 1000));\n          this._currentView = await this._quit.runAsync(this._mainView);\n        }\n      }\n    }\n  }\n\n  changeMainView(view: IView) {\n    this._mainView = view;\n  }\n}\n"],"file":"route.js"}