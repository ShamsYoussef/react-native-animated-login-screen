{"version":3,"sources":["../src/log.ts"],"names":["_bundleProgressBar","_oraSpinner","_printNewLineBeforeNextLog","_isLastLineNewLine","_updateIsLastLineNewLine","args","length","lastArg","match","_maybePrintNewLine","console","log","consoleLog","consoleWarn","warn","consoleError","error","respectProgressBars","commitLogs","terminate","lastDraw","stop","render","start","getPrefix","chalkColor","Date","toTimeString","slice","withPrefixAndTextColor","chalk","gray","program","nonInteractive","map","arg","withPrefix","nested","message","newLine","addNewLineIfNone","printNewLineBeforeNextLog","setBundleProgressBar","bar","setSpinner","oraSpinner","red","nestedError","yellow","nestedWarn","terminalLink"],"mappings":"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","sourcesContent":["import chalk from 'chalk';\nimport terminalLink from 'terminal-link';\nimport program from 'commander';\n\ntype Color = (...text: string[]) => string;\n\nlet _bundleProgressBar: any;\nlet _oraSpinner: any;\n\nlet _printNewLineBeforeNextLog = false;\nlet _isLastLineNewLine = false;\nfunction _updateIsLastLineNewLine(args: any[]) {\n  if (args.length === 0) {\n    _isLastLineNewLine = true;\n  } else {\n    let lastArg = args[args.length - 1];\n    if (typeof lastArg === 'string' && (lastArg === '' || lastArg.match(/[\\r\\n]$/))) {\n      _isLastLineNewLine = true;\n    } else {\n      _isLastLineNewLine = false;\n    }\n  }\n}\n\nfunction _maybePrintNewLine() {\n  if (_printNewLineBeforeNextLog) {\n    _printNewLineBeforeNextLog = false;\n    console.log();\n  }\n}\n\nfunction consoleLog(...args: any[]) {\n  _maybePrintNewLine();\n  _updateIsLastLineNewLine(args);\n\n  console.log(...args);\n}\n\nfunction consoleWarn(...args: any[]) {\n  _maybePrintNewLine();\n  _updateIsLastLineNewLine(args);\n\n  console.warn(...args);\n}\n\nfunction consoleError(...args: any[]) {\n  _maybePrintNewLine();\n  _updateIsLastLineNewLine(args);\n\n  console.error(...args);\n}\n\nfunction respectProgressBars(commitLogs: () => void) {\n  if (_bundleProgressBar) {\n    _bundleProgressBar.terminate();\n    _bundleProgressBar.lastDraw = '';\n  }\n  if (_oraSpinner) {\n    _oraSpinner.stop();\n  }\n  commitLogs();\n\n  if (_bundleProgressBar) {\n    _bundleProgressBar.render();\n  }\n  if (_oraSpinner) {\n    _oraSpinner.start();\n  }\n}\n\nfunction getPrefix(chalkColor: Color) {\n  return chalkColor(`[${new Date().toTimeString().slice(0, 8)}]`);\n}\n\nfunction withPrefixAndTextColor(args: any[], chalkColor: Color = chalk.gray) {\n  if (program.nonInteractive) {\n    return [getPrefix(chalkColor), ...args.map(arg => chalkColor(arg))];\n  } else {\n    return args.map(arg => chalkColor(arg));\n  }\n}\n\nfunction withPrefix(args: any[], chalkColor = chalk.gray) {\n  if (program.nonInteractive) {\n    return [getPrefix(chalkColor), ...args];\n  } else {\n    return args;\n  }\n}\n\nfunction log(...args: any[]) {\n  respectProgressBars(() => {\n    consoleLog(...withPrefix(args));\n  });\n}\n\nlog.nested = function (message: any) {\n  respectProgressBars(() => {\n    consoleLog(message);\n  });\n};\n\nlog.newLine = function newLine() {\n  respectProgressBars(() => {\n    consoleLog();\n  });\n};\n\nlog.addNewLineIfNone = function addNewLineIfNone() {\n  if (!_isLastLineNewLine && !_printNewLineBeforeNextLog) {\n    log.newLine();\n  }\n};\n\nlog.printNewLineBeforeNextLog = function printNewLineBeforeNextLog() {\n  _printNewLineBeforeNextLog = true;\n};\n\nlog.setBundleProgressBar = function setBundleProgressBar(bar: any) {\n  _bundleProgressBar = bar;\n};\n\nlog.setSpinner = function setSpinner(oraSpinner: any) {\n  _oraSpinner = oraSpinner;\n};\n\nlog.error = function error(...args: any[]) {\n  respectProgressBars(() => {\n    consoleError(...withPrefixAndTextColor(args, chalk.red));\n  });\n};\n\nlog.nestedError = function (message: string) {\n  respectProgressBars(() => {\n    consoleError(chalk.red(message));\n  });\n};\n\nlog.warn = function warn(...args: any[]) {\n  respectProgressBars(() => {\n    consoleWarn(...withPrefixAndTextColor(args, chalk.yellow));\n  });\n};\n\nlog.nestedWarn = function (message: string) {\n  respectProgressBars(() => {\n    consoleWarn(chalk.yellow(message));\n  });\n};\n\nlog.gray = function (...args: any[]) {\n  respectProgressBars(() => {\n    consoleLog(...withPrefixAndTextColor(args));\n  });\n};\n\nlog.chalk = chalk;\nlog.terminalLink = terminalLink;\n\nexport default log;\n"],"file":"log.js"}