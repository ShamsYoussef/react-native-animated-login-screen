{"version":3,"sources":["../../../src/commands/utils/ClientUpgradeUtils.ts"],"names":["getExpoSdkConfig","path","projectRoot","exp","ConfigUtils","getConfig","skipSDKVersionRequirement","error","code","undefined","getClient","sdk","platform","androidClientUrl","url","version","androidClientVersion","iosClientUrl","iosClientVersion","getAvailableClients","options","Object","keys","sdkVersions","reverse","map","client","sdkVersionString","sdkVersion","clientUrl","clientVersion","filter","hasUrl","isDeprecated","IsCompatible","project","Versions","lteSdkVersion","askClientToInstall","answer","type","name","message","pageSize","choices","clients","clientLabels","latestSdkVersion","currentSdkVersion","Boolean","clientMessage","length","join","value","chalk","bold","gray","targetClient"],"mappings":"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","sourcesContent":["import * as ConfigUtils from '@expo/config';\nimport { Versions } from '@expo/xdl';\nimport chalk from 'chalk';\nimport prompt from '../../prompt';\nimport { findProjectRootAsync } from './ProjectUtils';\n\nexport async function getExpoSdkConfig(path: string) {\n  try {\n    const { projectRoot } = await findProjectRootAsync(path);\n    const { exp } = ConfigUtils.getConfig(projectRoot, {\n      skipSDKVersionRequirement: true,\n    });\n    return exp;\n  } catch (error) {\n    if (error.code !== 'NO_PROJECT') {\n      throw error;\n    }\n  }\n  return undefined;\n}\n\ntype ClientPlatform = 'android' | 'ios';\n\nexport function getClient(sdk: Versions.SDKVersion, platform: ClientPlatform) {\n  if (platform === 'android' && sdk.androidClientUrl) {\n    return {\n      url: sdk.androidClientUrl,\n      version: sdk.androidClientVersion,\n    };\n  }\n\n  if (platform === 'ios' && sdk.iosClientUrl) {\n    return {\n      url: sdk.iosClientUrl,\n      version: sdk.iosClientVersion,\n    };\n  }\n\n  return undefined;\n}\n\ninterface AvailableClientOptions {\n  sdkVersions: Versions.SDKVersions;\n  platform: ClientPlatform;\n  project?: ConfigUtils.ExpoConfig;\n}\n\ninterface AvailableClient {\n  sdkVersion: Versions.SDKVersion;\n  sdkVersionString: string;\n  clientUrl?: string;\n  clientVersion?: string;\n}\n\nexport function getAvailableClients(options: AvailableClientOptions): AvailableClient[] {\n  return Object.keys(options.sdkVersions)\n    .reverse()\n    .map(version => {\n      const client = getClient(options.sdkVersions[version], options.platform);\n\n      return {\n        sdkVersionString: version,\n        sdkVersion: options.sdkVersions[version],\n        clientUrl: client ? client.url : undefined,\n        clientVersion: client ? client.version : undefined,\n      };\n    })\n    .filter(client => {\n      const hasUrl = !!client.clientUrl;\n      const isDeprecated = !!client.sdkVersion.isDeprecated;\n      const IsCompatible = options.project\n        ? Versions.lteSdkVersion(options.project, client.sdkVersionString)\n        : true;\n\n      return !isDeprecated && IsCompatible && hasUrl;\n    });\n}\n\ninterface InstallClientOptions {\n  clients: AvailableClient[];\n  latestSdkVersion?: string;\n  currentSdkVersion?: string;\n}\n\nexport async function askClientToInstall(options: InstallClientOptions): Promise<AvailableClient> {\n  const answer = await prompt({\n    type: 'list',\n    name: 'targetClient',\n    message: 'Choose an SDK version to install the client for:',\n    pageSize: 20,\n    choices: options.clients.map(client => {\n      const clientVersion = `- client ${client.clientVersion || 'version unknown'}`;\n      const clientLabels = [\n        client.sdkVersionString === options.latestSdkVersion && 'latest',\n        client.sdkVersionString === options.currentSdkVersion && 'recommended',\n      ].filter(Boolean);\n\n      const clientMessage = clientLabels.length\n        ? `${clientVersion} (${clientLabels.join(', ')})`\n        : clientVersion;\n\n      return {\n        value: client,\n        name: `${chalk.bold(client.sdkVersionString)} ${chalk.gray(clientMessage)}`,\n      };\n    }),\n  });\n\n  return answer.targetClient;\n}\n"],"file":"ClientUpgradeUtils.js"}